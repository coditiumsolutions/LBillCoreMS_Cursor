@model List<BMSBT.ViewModels.BillsViewModel>

@{
    Layout = "~/Views/Shared/_LayoutEBills.cshtml";
    var accordionId = "sectorAccordion";
    int count = 0;
}

<h4 class="mb-4">
    Electricity Bills –
    @ViewBag.SelectedMonth @ViewBag.SelectedYear
</h4>


@* <form method="get" asp-action="SGEBills"> *@
@*     <div class="row mb-4"> *@
@*         <div class="col-md-4"> *@
@*             <label class="form-label fw-bold">Search by BT No:</label> *@
@*             <input type="text" name="btNoSearch" value="@ViewBag.BTNoSearch" class="form-control" placeholder="Enter BT No..." /> *@
@*         </div> *@
@*         <div class="col-md-2 d-flex align-items-end"> *@
@*             <button type="submit" class="btn btn-primary">Search</button> *@
@*         </div> *@
@*     </div> *@
@* </form> *@



<form method="post" asp-action="SGEBills">
    <div class="row mb-4">
        <div class="col-md-3">
            <label class="form-label fw-bold">Billing Month</label>
            <select class="form-select" name="billingMonth">
                @foreach (var month in (List<string>)ViewBag.MonthList)
                {
                    <option value="@month"
                            selected="@(month == (string)ViewBag.SelectedMonth ? "selected" : null)">
                        @month
                    </option>
                }
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label fw-bold">Billing Year</label>
            <select class="form-select" name="billingYear">
                @foreach (var year in (List<string>)ViewBag.YearList)
                {
                    <option value="@year"
                            selected="@(year == (string)ViewBag.SelectedYear ? "selected" : null)">
                        @year
                    </option>
                }
            </select>
        </div>
        <div class="col-md-3">
            <label class="form-label fw-bold">Search by BT No</label>
            <input type="text"
                   class="form-control"
                   name="btNoSearch"
                   value="@ViewBag.BTNoSearch"
                   placeholder="Enter BT No (optional)" />
        </div>
        <div class="col-md-3 d-flex align-items-end">
            <button type="submit" class="btn btn-primary">Search</button>
        </div>
    </div>
</form>




<div class="accordion" id="@accordionId">
    @if (Model != null && Model.Count > 0)
    {
        foreach (var group in Model)
        {
            var collapseId = $"collapse_{count}";
            var headingId = $"heading_{count}";
            <div class="accordion-item">
                <h2 class="accordion-header" id="@headingId">
                    <button class="accordion-button collapsed"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#@collapseId"
                            aria-expanded="false"
                            aria-controls="@collapseId">
                        Sector: @group.Sector
                        <span class="ms-3 text-muted">
                            (Total: @group.Bills.Count)
                        </span>
                    </button>
                </h2>
                <div id="@collapseId"
                     class="accordion-collapse collapse"
                     aria-labelledby="@headingId"
                     data-bs-parent="#@accordionId">
                    <div class="accordion-body p-0">
                        <table class="table table-bordered table-striped mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>Invoice No</th>
                                    <th>Customer No</th>
                                    <th>BT No</th>
                                    <th>Customer Name</th>
                                    <th>Bill Amount</th>
                                    <th>Due Date</th>
                                    <th>Payment Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var bill in group.Bills)
                                {
                                    <tr ondblclick="location.href='@Url.Action("SGViewEBill", "SGEBills", new { id = bill.Uid })'"
                                        style="cursor: pointer;">
                                        <td>@bill.InvoiceNo</td>
                                        <td>@bill.CustomerNo</td>
                                        <td>@bill.Btno</td>
                                        <td>@bill.CustomerName</td>
                                        <td>@bill.BillAmount</td>
                                        <td>@bill.DueDate?.ToString("dd-MMM-yyyy")</td>
                                        <td>@bill.PaymentStatus</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            count++;
        }
    }
    else
    {
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i> No bills found for
            @ViewBag.SelectedMonth @ViewBag.SelectedYear.
        </div>
    }
</div>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>