
@{
    ViewData["Title"] = "BillReport";
    Layout = "~/Views/Shared/_LayoutReports.cshtml";
}
<style>
    select {
        width: 200px; /* Adjust width as needed */
        padding: 8px; /* Increase padding for better appearance */
        font-size: 16px; /* Make text more readable */
        border-radius: 5px; /* Rounded corners */
        border: 1px solid #ccc; /* Light border */
        background-color: #fff; /* White background */
    }
</style>
<h3>E-Bills (Month Wise)</h3>


<select id="monthSelect">
    <option value="January">January</option>
    <option value="February">February</option>
    <option value="March" selected>March</option>
    <option value="April">April</option>
    <option value="May">May</option>
    <option value="June">June</option>
    <option value="July">July</option>
    <option value="August">August</option>
    <option value="September">September</option>
    <option value="October">October</option>
    <option value="November">November</option>
    <option value="December">December</option>
</select>

<select id="yearSelect">
    <option value="2024">2024</option>
    <option value="2025" selected>2025</option>
    <option value="2026">2026</option>
</select>

<div style="width: 600px; height: 400px;">
    <canvas id="billChart"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    let myChart;

    function fetchAndRenderChart() {
        let month = $("#monthSelect").val();
        let year = $("#yearSelect").val();

        $.ajax({
            url: '@Url.Action("GetBillData", "Graphs")', // Your "Graphs" controller
            type: "POST",
            data: { month: month, year: year },
            success: function (response) {
           console.log("API Response:", response); // Log response to check its structure

     if (!response || !response.labels || !response.data) {
        console.error("Invalid API response structure:", response);
        return;
    }

    // If no data exists for the selected month, set graph to zero values
    if (response.labels.length === 0 || response.data.length === 0) {
        console.warn("No data available for the selected filters.");
        updateChart(["No Data"], [0]); // Set graph to show "No Data"
        return;
    }

    if (response.labels.length > 0 && response.data.length > 0) {
        updateChart(response.labels, response.data); // Use lowercase 'labels' and 'data'
    } else {
        console.warn("No data available for the selected filters.");
    }

    }
        });
    }



    function updateChart(labels, data) {
        if (myChart) {
            myChart.destroy(); // Destroy previous chart
        }

        let ctx = document.getElementById('billChart').getContext('2d');
        myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Total Bills',
                    data: data,
                    backgroundColor: ['green', 'red', 'orange'],
                    borderColor: ['darkgreen', 'darkred', 'darkorange'],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,  // âœ… Prevents infinite expansion
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    }

    $(document).ready(function () {
        fetchAndRenderChart(); // Load initial chart

        $("#monthSelect, #yearSelect").change(function () {
            fetchAndRenderChart();
        });
    });
</script>
